# ä¿®æ”¹å¯†ç åŠŸèƒ½å®Œæˆè¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

å®ç°äº†å®Œæ•´çš„å¯†ç ä¿®æ”¹åŠŸèƒ½ï¼Œæä¾›ä¸¤ç§ä¿®æ”¹æ–¹å¼ï¼Œæ»¡è¶³ä¸åŒåœºæ™¯éœ€æ±‚ã€‚

## åŠŸèƒ½ç‰¹ç‚¹

### 1. åŒé‡ä¿®æ”¹æ–¹å¼

#### æ–¹å¼ä¸€ï¼šé€šè¿‡åŸå¯†ç ä¿®æ”¹
- é€‚ç”¨åœºæ™¯ï¼šç”¨æˆ·è®°å¾—åŸå¯†ç 
- éªŒè¯æ–¹å¼ï¼šåŸå¯†ç éªŒè¯
- å®‰å…¨æ€§ï¼šé«˜

#### æ–¹å¼äºŒï¼šé€šè¿‡æ‰‹æœºå·ä¿®æ”¹
- é€‚ç”¨åœºæ™¯ï¼šå¿˜è®°åŸå¯†ç 
- éªŒè¯æ–¹å¼ï¼šçŸ­ä¿¡éªŒè¯ç 
- å®‰å…¨æ€§ï¼šé«˜

### 2. å¯†ç å®‰å…¨æœºåˆ¶

- âœ… å¯†ç é•¿åº¦é™åˆ¶ï¼ˆè‡³å°‘6ä½ï¼‰
- âœ… æ–°æ—§å¯†ç ä¸èƒ½ç›¸åŒ
- âœ… åŸå¯†ç éªŒè¯
- âœ… éªŒè¯ç éªŒè¯ï¼ˆå¯é€‰ï¼‰
- âœ… ä¿®æ”¹åå¼ºåˆ¶é‡æ–°ç™»å½•

## å‰ç«¯å®ç°

### é¡µé¢æ–‡ä»¶

**æ–‡ä»¶**: `dspace/src/pages/password/password.vue`

### UIå¸ƒå±€

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  é€šè¿‡åŸå¯†ç ä¿®æ”¹       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ åŸå¯†ç ï¼š  ğŸ‘ï¸  â”‚  â”‚
â”‚  â”‚ æ–°å¯†ç ï¼š  ğŸ‘ï¸  â”‚  â”‚
â”‚  â”‚  [ä¿å­˜]       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                      â”‚
â”‚  é€šè¿‡æ‰‹æœºå·ä¿®æ”¹       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ æ‰‹æœºå·ï¼š       â”‚  â”‚
â”‚  â”‚ éªŒè¯ç ï¼š[è·å–] â”‚  â”‚
â”‚  â”‚ æ–°å¯†ç ï¼š  ğŸ‘ï¸  â”‚  â”‚
â”‚  â”‚  [ä¿å­˜]       â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### æ ¸å¿ƒåŠŸèƒ½

#### 1. å¯†ç æ˜¾ç¤ºåˆ‡æ¢

```javascript
// å°çœ¼ç›å›¾æ ‡åˆ‡æ¢
toggleOldPassword() {
  this.showOldPassword = !this.showOldPassword
}
```

**å®ç°æ•ˆæœ**ï¼š
- é»˜è®¤ï¼šå¯†ç ä¸º `******`
- ç‚¹å‡»çœ¼ç›ï¼šæ˜¾ç¤ºæ˜æ–‡ `123456`
- å†æ¬¡ç‚¹å‡»ï¼šæ¢å¤å¯†æ–‡ `******`

#### 2. éªŒè¯ç å€’è®¡æ—¶

```javascript
startCountdown() {
  this.countdown = 60
  const timer = setInterval(() => {
    this.countdown--
    if (this.countdown <= 0) {
      clearInterval(timer)
    }
  }, 1000)
}
```

**æ˜¾ç¤ºæ•ˆæœ**ï¼š
- åˆå§‹ï¼š`è·å–éªŒè¯ç `
- ç‚¹å‡»åï¼š`60s` â†’ `59s` â†’ ... â†’ `1s`
- å€’è®¡æ—¶ç»“æŸï¼š`è·å–éªŒè¯ç `

#### 3. è¡¨å•éªŒè¯

**é€šè¿‡åŸå¯†ç ä¿®æ”¹**ï¼š
- åŸå¯†ç ä¸èƒ½ä¸ºç©º
- æ–°å¯†ç ä¸èƒ½ä¸ºç©º
- æ–°å¯†ç è‡³å°‘6ä½
- æ–°æ—§å¯†ç ä¸èƒ½ç›¸åŒ

**é€šè¿‡æ‰‹æœºå·ä¿®æ”¹**ï¼š
- æ‰‹æœºå·æ ¼å¼éªŒè¯
- éªŒè¯ç ä¸èƒ½ä¸ºç©º
- æ–°å¯†ç ä¸èƒ½ä¸ºç©º
- æ–°å¯†ç è‡³å°‘6ä½

#### 4. ä¿®æ”¹æˆåŠŸå¤„ç†

```javascript
// ä¿®æ”¹æˆåŠŸå
uni.showToast({ title: 'å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•' })

// 2ç§’å
setTimeout(() => {
  uni.removeStorageSync('token')
  uni.removeStorageSync('userInfo')
  uni.reLaunch({
    url: '/pages/login/login?phone=' + this.phone
  })
}, 2000)
```

**æµç¨‹**ï¼š
1. æç¤ºä¿®æ”¹æˆåŠŸ
2. æ¸…é™¤æœ¬åœ°tokenå’Œç”¨æˆ·ä¿¡æ¯
3. è·³è½¬åˆ°ç™»å½•é¡µ
4. è‡ªåŠ¨å¡«å…¥æ‰‹æœºå·

## åç«¯å®ç°

### Serviceå±‚æ–¹æ³•

**æ–‡ä»¶**: `iot_server/src/main/java/com/example/demo/service/UserService.java`

#### 1. sendResetPasswordCode

```java
public void sendResetPasswordCode(String phone)
```

**åŠŸèƒ½**ï¼šå‘é€é‡ç½®å¯†ç éªŒè¯ç 

**éªŒè¯**ï¼š
- æ£€æŸ¥æ‰‹æœºå·æ˜¯å¦å·²æ³¨å†Œ
- æœªæ³¨å†Œåˆ™æŠ›å‡ºå¼‚å¸¸

#### 2. changePasswordByOld

```java
@Transactional
public void changePasswordByOld(Long userId, String oldPassword, String newPassword)
```

**åŠŸèƒ½**ï¼šé€šè¿‡åŸå¯†ç ä¿®æ”¹å¯†ç 

**éªŒè¯**ï¼š
- ç”¨æˆ·å­˜åœ¨æ€§
- åŸå¯†ç æ­£ç¡®æ€§
- æ–°æ—§å¯†ç ä¸èƒ½ç›¸åŒ

#### 3. changePasswordByPhone

```java
@Transactional
public void changePasswordByPhone(String phone, String verifyCode, String newPassword)
```

**åŠŸèƒ½**ï¼šé€šè¿‡æ‰‹æœºå·éªŒè¯ç ä¿®æ”¹å¯†ç 

**éªŒè¯**ï¼š
- æ‰‹æœºå·å·²æ³¨å†Œ
- éªŒè¯ç æ­£ç¡®ï¼ˆå¼€å‘é˜¶æ®µæš‚ä¸æ ¡éªŒï¼‰

### Controllerå±‚æ¥å£

**æ–‡ä»¶**: `iot_server/src/main/java/com/example/demo/controller/UserController.java`

#### 1. å‘é€é‡ç½®å¯†ç éªŒè¯ç 

```
POST /user/sendResetPasswordCode
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "phone": "13800138000"
}
```

**å“åº”**ï¼š
```json
{
  "code": 200,
  "msg": "success",
  "data": "éªŒè¯ç å·²å‘é€"
}
```

**è¯´æ˜**ï¼š
- ä¸éœ€è¦Token
- æ‰‹æœºå·å¿…é¡»å·²æ³¨å†Œ
- éªŒè¯ç åœ¨åç«¯æ§åˆ¶å°è¾“å‡º

#### 2. é€šè¿‡åŸå¯†ç ä¿®æ”¹

```
POST /user/changePasswordByOld
```

**è¯·æ±‚å¤´**ï¼š`Authorization: <token>`

**è¯·æ±‚ä½“**ï¼š
```json
{
  "oldPassword": "123456",
  "newPassword": "654321"
}
```

**å“åº”**ï¼š
```json
{
  "code": 200,
  "msg": "success",
  "data": "å¯†ç ä¿®æ”¹æˆåŠŸ"
}
```

**è¯´æ˜**ï¼š
- éœ€è¦Tokenï¼ˆå·²ç™»å½•ï¼‰
- åŸå¯†ç å¿…é¡»æ­£ç¡®
- æ–°æ—§å¯†ç ä¸èƒ½ç›¸åŒ

#### 3. é€šè¿‡æ‰‹æœºå·ä¿®æ”¹

```
POST /user/changePasswordByPhone
```

**è¯·æ±‚ä½“**ï¼š
```json
{
  "phone": "13800138000",
  "verifyCode": "123456",
  "newPassword": "654321"
}
```

**å“åº”**ï¼š
```json
{
  "code": 200,
  "msg": "success",
  "data": "å¯†ç ä¿®æ”¹æˆåŠŸ"
}
```

**è¯´æ˜**ï¼š
- ä¸éœ€è¦Tokenï¼ˆæ‰¾å›å¯†ç åœºæ™¯ï¼‰
- æ‰‹æœºå·å¿…é¡»å·²æ³¨å†Œ
- éªŒè¯ç å¿…é¡»æ­£ç¡®ï¼ˆå¼€å‘é˜¶æ®µä¸æ ¡éªŒï¼‰

### DTOç±»

#### ChangePasswordByOldRequest

```java
@Data
public class ChangePasswordByOldRequest {
    @NotBlank(message = "åŸå¯†ç ä¸èƒ½ä¸ºç©º")
    private String oldPassword;

    @NotBlank(message = "æ–°å¯†ç ä¸èƒ½ä¸ºç©º")
    @Size(min = 6, message = "å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½")
    private String newPassword;
}
```

#### ChangePasswordByPhoneRequest

```java
@Data
public class ChangePasswordByPhoneRequest {
    @NotBlank(message = "æ‰‹æœºå·ä¸èƒ½ä¸ºç©º")
    @Pattern(regexp = "^1[3-9]\\d{9}$", message = "æ‰‹æœºå·æ ¼å¼ä¸æ­£ç¡®")
    private String phone;

    @NotBlank(message = "éªŒè¯ç ä¸èƒ½ä¸ºç©º")
    private String verifyCode;

    @NotBlank(message = "æ–°å¯†ç ä¸èƒ½ä¸ºç©º")
    @Size(min = 6, message = "å¯†ç é•¿åº¦ä¸èƒ½å°‘äº6ä½")
    private String newPassword;
}
```

## APIæ¥å£æ¸…å•

### ä¿®æ”¹å¯†ç ç›¸å…³

| æ¥å£ | æ–¹æ³• | è¯´æ˜ | éœ€è¦Token |
|------|------|------|-----------|
| `/user/sendResetPasswordCode` | POST | å‘é€é‡ç½®å¯†ç éªŒè¯ç  | âŒ |
| `/user/changePasswordByOld` | POST | é€šè¿‡åŸå¯†ç ä¿®æ”¹ | âœ… |
| `/user/changePasswordByPhone` | POST | é€šè¿‡æ‰‹æœºå·ä¿®æ”¹ | âŒ |

## ä½¿ç”¨åœºæ™¯

### åœºæ™¯1: ç”¨æˆ·ä¸»åŠ¨ä¿®æ”¹å¯†ç ï¼ˆè®°å¾—åŸå¯†ç ï¼‰

```
ç”¨æˆ·ç™»å½•å
    â†“
è¿›å…¥"æˆ‘çš„"é¡µé¢
    â†“
ç‚¹å‡»"ä¿®æ”¹å¯†ç "
    â†“
è¾“å…¥åŸå¯†ç å’Œæ–°å¯†ç 
    â†“
ç‚¹å‡»ä¿å­˜
    â†“
å¯†ç ä¿®æ”¹æˆåŠŸ
    â†“
é‡æ–°ç™»å½•
```

### åœºæ™¯2: å¿˜è®°å¯†ç ï¼ˆæ‰¾å›å¯†ç ï¼‰

```
ç”¨æˆ·å¿˜è®°å¯†ç 
    â†“
è¿›å…¥ä¿®æ”¹å¯†ç é¡µé¢
    â†“
ä½¿ç”¨"é€šè¿‡æ‰‹æœºå·ä¿®æ”¹"
    â†“
è¾“å…¥æ‰‹æœºå·
    â†“
è·å–éªŒè¯ç 
    â†“
è¾“å…¥éªŒè¯ç å’Œæ–°å¯†ç 
    â†“
ç‚¹å‡»ä¿å­˜
    â†“
å¯†ç é‡ç½®æˆåŠŸ
    â†“
é‡æ–°ç™»å½•
```

### åœºæ™¯3: ç™»å½•é¡µé¢æ‰¾å›å¯†ç 

å¯ä»¥åœ¨ç™»å½•é¡µé¢æ·»åŠ "å¿˜è®°å¯†ç "é“¾æ¥ï¼š

```javascript
toForgetPassword() {
  uni.navigateTo({
    url: '/pages/password/password'
  })
}
```

## å®‰å…¨æœºåˆ¶

### 1. å¯†ç å¼ºåº¦

- æœ€å°é•¿åº¦ï¼š6ä½
- å‰ç«¯éªŒè¯ + åç«¯éªŒè¯
- å»ºè®®åŒ…å«æ•°å­—å’Œå­—æ¯

### 2. åŸå¯†ç éªŒè¯

```java
if (!user.getPassword().equals(oldPassword)) {
    throw new RuntimeException("åŸå¯†ç é”™è¯¯");
}
```

### 3. éªŒè¯ç éªŒè¯

```java
boolean isCodeValid = verifyCodeService.verifyCode(phone, verifyCode);
if (!isCodeValid) {
    throw new RuntimeException("éªŒè¯ç é”™è¯¯æˆ–å·²è¿‡æœŸ");
}
```

**æ³¨æ„**ï¼šå¼€å‘é˜¶æ®µæš‚ä¸æ ¡éªŒï¼Œç”Ÿäº§ç¯å¢ƒéœ€è¦å¯ç”¨ã€‚

### 4. ä¿®æ”¹åå¼ºåˆ¶é‡æ–°ç™»å½•

- æ¸…é™¤æœ¬åœ°Token
- æ¸…é™¤ç”¨æˆ·ä¿¡æ¯
- è·³è½¬åˆ°ç™»å½•é¡µ
- ç¡®ä¿è´¦å·å®‰å…¨

## æµ‹è¯•æ­¥éª¤

### æµ‹è¯•1: é€šè¿‡åŸå¯†ç ä¿®æ”¹

1. ç™»å½•ç³»ç»Ÿ
2. è¿›å…¥"æˆ‘çš„"é¡µé¢
3. ç‚¹å‡»"ä¿®æ”¹å¯†ç "
4. åœ¨ç¬¬ä¸€éƒ¨åˆ†å¡«å†™ï¼š
   - åŸå¯†ç ï¼š`123456`
   - æ–°å¯†ç ï¼š`654321`
5. ç‚¹å‡»å°çœ¼ç›æŸ¥çœ‹æ˜æ–‡
6. ç‚¹å‡»"ä¿å­˜"
7. âœ… åº”è¯¥æç¤º"å¯†ç ä¿®æ”¹æˆåŠŸï¼Œè¯·é‡æ–°ç™»å½•"
8. âœ… 2ç§’åè·³è½¬åˆ°ç™»å½•é¡µ
9. ä½¿ç”¨æ–°å¯†ç  `654321` ç™»å½•
10. âœ… åº”è¯¥èƒ½æˆåŠŸç™»å½•

### æµ‹è¯•2: é€šè¿‡æ‰‹æœºå·ä¿®æ”¹

1. åœ¨ä¿®æ”¹å¯†ç é¡µé¢ï¼ˆæœªç™»å½•ä¹Ÿå¯ä»¥ï¼‰
2. åœ¨ç¬¬äºŒéƒ¨åˆ†å¡«å†™ï¼š
   - æ‰‹æœºå·ï¼š`13800138000`
   - ç‚¹å‡»"è·å–éªŒè¯ç "
   - âœ… åç«¯æ§åˆ¶å°æŸ¥çœ‹éªŒè¯ç 
   - è¾“å…¥éªŒè¯ç 
   - æ–°å¯†ç ï¼š`888888`
3. ç‚¹å‡»"ä¿å­˜"
4. âœ… æç¤º"å¯†ç ä¿®æ”¹æˆåŠŸ"
5. è·³è½¬åˆ°ç™»å½•é¡µ
6. ä½¿ç”¨æ–°å¯†ç ç™»å½•
7. âœ… åº”è¯¥èƒ½æˆåŠŸç™»å½•

### æµ‹è¯•3: è¡¨å•éªŒè¯

**åŸå¯†ç æ–¹å¼**ï¼š
- åŸå¯†ç ä¸ºç©º â†’ "è¯·è¾“å…¥åŸå¯†ç "
- æ–°å¯†ç ä¸ºç©º â†’ "è¯·è¾“å…¥æ–°å¯†ç "
- æ–°å¯†ç <6ä½ â†’ "æ–°å¯†ç è‡³å°‘6ä½"
- æ–°æ—§å¯†ç ç›¸åŒ â†’ "æ–°å¯†ç ä¸èƒ½ä¸åŸå¯†ç ç›¸åŒ"
- åŸå¯†ç é”™è¯¯ â†’ "åŸå¯†ç é”™è¯¯"

**æ‰‹æœºå·æ–¹å¼**ï¼š
- æ‰‹æœºå·ä¸ºç©º â†’ "è¯·è¾“å…¥æ‰‹æœºå·"
- æ‰‹æœºå·æ ¼å¼é”™è¯¯ â†’ "è¯·è¾“å…¥æ­£ç¡®çš„æ‰‹æœºå·"
- éªŒè¯ç ä¸ºç©º â†’ "è¯·è¾“å…¥éªŒè¯ç "
- æ–°å¯†ç ä¸ºç©º â†’ "è¯·è¾“å…¥æ–°å¯†ç "
- æ–°å¯†ç <6ä½ â†’ "æ–°å¯†ç è‡³å°‘6ä½"
- æ‰‹æœºå·æœªæ³¨å†Œ â†’ "è¯¥æ‰‹æœºå·æœªæ³¨å†Œ"
- éªŒè¯ç é”™è¯¯ â†’ "éªŒè¯ç é”™è¯¯æˆ–å·²è¿‡æœŸ"ï¼ˆç”Ÿäº§ç¯å¢ƒï¼‰

## ç›¸å…³æ–‡ä»¶æ¸…å•

### å‰ç«¯æ–‡ä»¶
- `dspace/src/pages/password/password.vue` - ä¿®æ”¹å¯†ç é¡µé¢ï¼ˆæ–°å¢ï¼‰
- `dspace/src/pages.json` - æ·»åŠ é¡µé¢é…ç½®
- `dspace/src/components/tab-views/myMine.vue` - æˆ‘çš„é¡µé¢ï¼ˆå·²æœ‰è·³è½¬ï¼‰

### åç«¯æ–‡ä»¶
- `iot_server/src/main/java/com/example/demo/controller/UserController.java` - æ·»åŠ 3ä¸ªæ¥å£
- `iot_server/src/main/java/com/example/demo/service/UserService.java` - æ·»åŠ 3ä¸ªæ–¹æ³•
- `iot_server/src/main/java/com/example/demo/dto/ChangePasswordByOldRequest.java` - DTOï¼ˆæ–°å¢ï¼‰
- `iot_server/src/main/java/com/example/demo/dto/ChangePasswordByPhoneRequest.java` - DTOï¼ˆæ–°å¢ï¼‰

## UIè®¾è®¡

### é…è‰²æ–¹æ¡ˆ

| å…ƒç´  | é¢œè‰² | è¯´æ˜ |
|------|------|------|
| èƒŒæ™¯ | #080822 | æ·±è“é»‘è‰² |
| è¡¨å•å®¹å™¨ | #04041a | æ·±è‰²å¡ç‰‡ |
| è¾¹æ¡† | #6A5ACD | ç´«è‰²ä¸»é¢˜ |
| æ ‡é¢˜ | #6A5ACD | ç´«è‰² |
| è¾“å…¥æ¡† | #1c1c26 | æ·±ç°è‰² |
| æŒ‰é’® | #6A5ACD | ç´«è‰² |
| çœ¼ç›å›¾æ ‡ | #6A5ACD | ç´«è‰² |

### å°ºå¯¸è§„æ ¼

| å…ƒç´  | å°ºå¯¸ |
|------|------|
| è¾“å…¥æ¡†é«˜åº¦ | 70rpx |
| æŒ‰é’®é«˜åº¦ | 80rpx |
| éªŒè¯ç æŒ‰é’® | 50rpx |
| å­—ä½“å¤§å° | 28-32rpx |

### äº¤äº’æ•ˆæœ

- âœ… ç‚¹å‡»çœ¼ç›åˆ‡æ¢å¯†ç æ˜¾ç¤º
- âœ… éªŒè¯ç æŒ‰é’®60ç§’å€’è®¡æ—¶
- âœ… æŒ‰é’®ç‚¹å‡»æœ‰activeæ•ˆæœ
- âœ… è¾“å…¥æ¡†è·ç„¦æœ‰é«˜äº®
- âœ… è¡¨å•éªŒè¯å®æ—¶åé¦ˆ

## å·¥ä½œæµç¨‹

### é€šè¿‡åŸå¯†ç ä¿®æ”¹æµç¨‹

```
ç”¨æˆ·è¾“å…¥
    â†“
å‰ç«¯éªŒè¯
    â”œâ”€ åŸå¯†ç ä¸ºç©º â†’ æç¤º
    â”œâ”€ æ–°å¯†ç ä¸ºç©º â†’ æç¤º
    â”œâ”€ æ–°å¯†ç <6ä½ â†’ æç¤º
    â””â”€ æ–°æ—§ç›¸åŒ â†’ æç¤º
    â†“
å‘é€è¯·æ±‚
POST /user/changePasswordByOld
    â†“
åç«¯éªŒè¯
    â”œâ”€ TokenéªŒè¯
    â”œâ”€ ç”¨æˆ·å­˜åœ¨æ€§
    â”œâ”€ åŸå¯†ç æ­£ç¡®æ€§
    â””â”€ æ–°æ—§å¯†ç ä¸åŒ
    â†“
æ›´æ–°æ•°æ®åº“
UPDATE users SET password = ?
    â†“
è¿”å›æˆåŠŸ
    â†“
æ¸…é™¤ç™»å½•ä¿¡æ¯
    â†“
è·³è½¬ç™»å½•é¡µ
    â†“
ç”¨æˆ·é‡æ–°ç™»å½•
```

### é€šè¿‡æ‰‹æœºå·ä¿®æ”¹æµç¨‹

```
ç”¨æˆ·è¾“å…¥æ‰‹æœºå·
    â†“
ç‚¹å‡»"è·å–éªŒè¯ç "
    â†“
å‘é€è¯·æ±‚
POST /user/sendResetPasswordCode
    â†“
åç«¯éªŒè¯
    â””â”€ æ‰‹æœºå·å·²æ³¨å†Œ
    â†“
å‘é€éªŒè¯ç ï¼ˆåç«¯æ§åˆ¶å°ï¼‰
    â†“
ç”¨æˆ·æŸ¥çœ‹å¹¶è¾“å…¥éªŒè¯ç 
    â†“
è¾“å…¥æ–°å¯†ç 
    â†“
ç‚¹å‡»ä¿å­˜
    â†“
å‘é€è¯·æ±‚
POST /user/changePasswordByPhone
    â†“
åç«¯éªŒè¯
    â”œâ”€ æ‰‹æœºå·å·²æ³¨å†Œ
    â”œâ”€ éªŒè¯ç æ­£ç¡®
    â””â”€ å¯†ç æ ¼å¼æ­£ç¡®
    â†“
æ›´æ–°æ•°æ®åº“
    â†“
è¿”å›æˆåŠŸ
    â†“
è·³è½¬ç™»å½•é¡µ
    â†“
ç”¨æˆ·ç™»å½•
```

## æ³¨æ„äº‹é¡¹

### 1. å®‰å…¨æ€§

- âš ï¸ **ç”Ÿäº§ç¯å¢ƒéœ€è¦å¯ç”¨éªŒè¯ç æ ¡éªŒ**
- âš ï¸ **å»ºè®®å¯†ç åŠ å¯†å­˜å‚¨**ï¼ˆå½“å‰æ˜¯æ˜æ–‡ï¼‰
- âš ï¸ **æ·»åŠ å¯†ç å¤æ‚åº¦è¦æ±‚**
- âš ï¸ **é™åˆ¶ä¿®æ”¹é¢‘ç‡**ï¼ˆé˜²æ­¢æš´åŠ›ç ´è§£ï¼‰

### 2. ç”¨æˆ·ä½“éªŒ

- âœ… ä¿®æ”¹æˆåŠŸåè‡ªåŠ¨å¡«å…¥æ‰‹æœºå·
- âœ… å°çœ¼ç›å›¾æ ‡ä¾¿äºæŸ¥çœ‹å¯†ç 
- âœ… éªŒè¯ç å€’è®¡æ—¶é˜²æ­¢é‡å¤å‘é€
- âœ… å‹å¥½çš„é”™è¯¯æç¤º

### 3. å¼€å‘ç¯å¢ƒ

- âœ… éªŒè¯ç åœ¨åç«¯æ§åˆ¶å°è¾“å‡º
- âœ… éªŒè¯ç æ ¡éªŒæš‚æ—¶å…³é—­
- âœ… å¯ä»¥è¾“å…¥ä»»æ„éªŒè¯ç 

### 4. ç”Ÿäº§ç¯å¢ƒ

éœ€è¦å–æ¶ˆæ³¨é‡ŠéªŒè¯ç æ ¡éªŒï¼š

```java
// UserService.java ä¸­
boolean isCodeValid = verifyCodeService.verifyCode(phone, verifyCode);
if (!isCodeValid) {
    throw new RuntimeException("éªŒè¯ç é”™è¯¯æˆ–å·²è¿‡æœŸ");
}
```

## æ‰©å±•å»ºè®®

### çŸ­æœŸä¼˜åŒ–

1. **å¯†ç å¼ºåº¦æç¤º**
   ```javascript
   // å®æ—¶æ˜¾ç¤ºå¯†ç å¼ºåº¦
   å¼±ï¼šåªæœ‰æ•°å­—æˆ–å­—æ¯
   ä¸­ï¼šæ•°å­—+å­—æ¯
   å¼ºï¼šæ•°å­—+å­—æ¯+ç‰¹æ®Šå­—ç¬¦
   ```

2. **å¯†ç ç¡®è®¤**
   ```vue
   <input placeholder="ç¡®è®¤æ–°å¯†ç " v-model="confirmPassword" />
   ```

3. **å†å²å¯†ç é™åˆ¶**
   ```java
   // ä¸èƒ½ä½¿ç”¨æœ€è¿‘3æ¬¡çš„å¯†ç 
   ```

### é•¿æœŸä¼˜åŒ–

1. **å¯†ç åŠ å¯†**
   ```java
   // ä½¿ç”¨BCryptåŠ å¯†
   String hashedPassword = BCrypt.hashpw(password, BCrypt.gensalt());
   ```

2. **å¯†ç å¤æ‚åº¦**
   ```javascript
   // å¿…é¡»åŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—
   const strongReg = /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d).{8,}$/
   ```

3. **ä¿®æ”¹æ—¥å¿—**
   ```java
   // è®°å½•å¯†ç ä¿®æ”¹æ—¥å¿—
   passwordChangeLog.insert(userId, oldPassword, newPassword, timestamp)
   ```

## æµ‹è¯•API

ä½¿ç”¨ HTTP å®¢æˆ·ç«¯æµ‹è¯•ï¼š

```http
### 1. å‘é€éªŒè¯ç 
POST http://127.0.0.1:8080/user/sendResetPasswordCode
Content-Type: application/json

{
  "phone": "13800138000"
}

### 2. é€šè¿‡åŸå¯†ç ä¿®æ”¹
POST http://127.0.0.1:8080/user/changePasswordByOld
Authorization: your-token-here
Content-Type: application/json

{
  "oldPassword": "123456",
  "newPassword": "654321"
}

### 3. é€šè¿‡æ‰‹æœºå·ä¿®æ”¹
POST http://127.0.0.1:8080/user/changePasswordByPhone
Content-Type: application/json

{
  "phone": "13800138000",
  "verifyCode": "123456",
  "newPassword": "888888"
}
```

## å¸¸è§é—®é¢˜

### Q1: ä¿®æ”¹å¯†ç åèƒ½ç”¨æ—§å¯†ç ç™»å½•å—ï¼Ÿ

**A**: ä¸èƒ½ã€‚å¯†ç ä¿®æ”¹æˆåŠŸåï¼Œå¿…é¡»ä½¿ç”¨æ–°å¯†ç ç™»å½•ã€‚

### Q2: ä¸è®°å¾—åŸå¯†ç æ€ä¹ˆåŠï¼Ÿ

**A**: ä½¿ç”¨"é€šè¿‡æ‰‹æœºå·ä¿®æ”¹"æ–¹å¼ï¼Œé€šè¿‡éªŒè¯ç é‡ç½®å¯†ç ã€‚

### Q3: éªŒè¯ç åœ¨å“ªé‡Œçœ‹ï¼Ÿ

**A**: å¼€å‘ç¯å¢ƒä¸‹ï¼ŒéªŒè¯ç ä¼šåœ¨åç«¯æ§åˆ¶å°è¾“å‡ºã€‚ç”Ÿäº§ç¯å¢ƒä¼šå‘é€çŸ­ä¿¡ã€‚

### Q4: ä¿®æ”¹å¯†ç åå…¶ä»–è®¾å¤‡ä¼šé€€å‡ºå—ï¼Ÿ

**A**: å½“å‰ç‰ˆæœ¬ä¸ä¼šã€‚å»ºè®®åæœŸå®ç°Tokenå¤±æ•ˆæœºåˆ¶ã€‚

### Q5: å¯ä»¥å¤šæ¬¡ä¿®æ”¹å¯†ç å—ï¼Ÿ

**A**: å¯ä»¥ã€‚ä½†å»ºè®®æ·»åŠ é¢‘ç‡é™åˆ¶ï¼Œå¦‚æ¯å¤©æœ€å¤šä¿®æ”¹3æ¬¡ã€‚

## å®Œæˆæ—¶é—´

2025-10-21

## çŠ¶æ€

âœ… å·²å®Œæˆï¼Œå¯æŠ•å…¥ä½¿ç”¨

## ä¸‹ä¸€æ­¥

1. é‡å¯åç«¯æœåŠ¡ï¼ˆåº”ç”¨æ–°æ¥å£ï¼‰
2. åˆ·æ–°å‰ç«¯é¡µé¢
3. æµ‹è¯•ä¿®æ”¹å¯†ç åŠŸèƒ½
4. éªŒè¯ä¸¤ç§ä¿®æ”¹æ–¹å¼éƒ½èƒ½æ­£å¸¸å·¥ä½œ

