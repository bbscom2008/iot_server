# Token è¿‡æœŸæµ‹è¯• - å¿«é€Ÿå¼€å§‹ â°

## âœ… é…ç½®å·²ä¿®æ”¹

**JWT Token æœ‰æ•ˆæœŸå·²æ”¹ä¸ºï¼š1 åˆ†é’Ÿï¼ˆ60000 æ¯«ç§’ï¼‰**

**é…ç½®æ–‡ä»¶ï¼š** `src/main/resources/application.properties`
```properties
jwt.expiration=60000  # 1 åˆ†é’Ÿ
```

---

## ğŸš€ ä¸‰æ­¥å¼€å§‹æµ‹è¯•

### ç¬¬ä¸€æ­¥ï¼šé‡å¯åç«¯ï¼ˆå¿…é¡»ï¼ï¼‰

```bash
# åœæ­¢å½“å‰è¿è¡Œçš„æœåŠ¡ï¼ˆCtrl+Cï¼‰
# é‡æ–°å¯åŠ¨
mvn spring-boot:run
```

**âš ï¸ é‡è¦ï¼š** ä¿®æ”¹é…ç½®åå¿…é¡»é‡å¯ï¼

---

### ç¬¬äºŒæ­¥ï¼šæ‰“å¼€è‡ªåŠ¨æµ‹è¯•é¡µé¢

**åœ¨æµè§ˆå™¨ä¸­æ‰“å¼€ï¼š**
```
test_token_expiration.html
```

---

### ç¬¬ä¸‰æ­¥ï¼šç‚¹å‡»"å¼€å§‹è‡ªåŠ¨æµ‹è¯•"

é¡µé¢ä¼šï¼š
1. âœ… è‡ªåŠ¨ç™»å½•è·å– token
2. â±ï¸ æ¯ 10 ç§’æµ‹è¯•ä¸€æ¬¡ token æ˜¯å¦æœ‰æ•ˆ
3. â° åœ¨çº¦ 60-70 ç§’æ—¶è§‚å¯Ÿåˆ° token è¿‡æœŸ
4. ğŸ“Š å®æ—¶æ˜¾ç¤ºè¿›åº¦å’ŒçŠ¶æ€

---

## ğŸ“Š æµ‹è¯•é¡µé¢åŠŸèƒ½

### çŠ¶æ€æ˜¾ç¤º
- **å·²æµ‹è¯•æ¬¡æ•°** - æ‰§è¡Œäº†å¤šå°‘æ¬¡éªŒè¯
- **å·²ç”¨æ—¶é—´** - ä»ç™»å½•å¼€å§‹ç»è¿‡çš„æ—¶é—´
- **Token çŠ¶æ€** - æœ‰æ•ˆ/å·²è¿‡æœŸ

### å®æ—¶æ—¥å¿—
- ğŸ• å¸¦æ—¶é—´æˆ³çš„è¯¦ç»†æ—¥å¿—
- âœ… ç»¿è‰²è¡¨ç¤ºæˆåŠŸ
- âŒ çº¢è‰²è¡¨ç¤ºå¤±è´¥/è¿‡æœŸ
- ğŸ“ è“è‰²è¡¨ç¤ºä¿¡æ¯

### è¿›åº¦æ¡
- æ˜¾ç¤ºæµ‹è¯•è¿›åº¦
- 0% â†’ 100%ï¼ˆé¢„è®¡ 80 ç§’ï¼‰

---

## ğŸ¯ é¢„æœŸæµ‹è¯•ç»“æœ

### æ—¶é—´çº¿

```
[14:30:00] ğŸš€ å¼€å§‹æµ‹è¯•ï¼Œç™»å½•æˆåŠŸ
[14:30:00] âœ… Token æœ‰æ•ˆæœŸï¼š1 åˆ†é’Ÿ

[14:30:10] ç¬¬1æ¬¡æµ‹è¯•ï¼ˆå·²è¿‡ 10ç§’ï¼‰âœ… Token æœ‰æ•ˆ
[14:30:20] ç¬¬2æ¬¡æµ‹è¯•ï¼ˆå·²è¿‡ 20ç§’ï¼‰âœ… Token æœ‰æ•ˆ
[14:30:30] ç¬¬3æ¬¡æµ‹è¯•ï¼ˆå·²è¿‡ 30ç§’ï¼‰âœ… Token æœ‰æ•ˆ
[14:30:40] ç¬¬4æ¬¡æµ‹è¯•ï¼ˆå·²è¿‡ 40ç§’ï¼‰âœ… Token æœ‰æ•ˆ
[14:30:50] ç¬¬5æ¬¡æµ‹è¯•ï¼ˆå·²è¿‡ 50ç§’ï¼‰âœ… Token æœ‰æ•ˆ
[14:31:00] ç¬¬6æ¬¡æµ‹è¯•ï¼ˆå·²è¿‡ 60ç§’ï¼‰âŒ Token å·²è¿‡æœŸï¼

ğŸ‰ æµ‹è¯•æˆåŠŸï¼JWT è¿‡æœŸæœºåˆ¶å·¥ä½œæ­£å¸¸
```

### è¿‡æœŸæ—¶çš„é”™è¯¯ä¿¡æ¯

```
âŒ Token å·²å¤±æ•ˆï¼
   é”™è¯¯: JWT expired at 2024-10-18T14:31:00Z. 
   Current time: 2024-10-18T14:31:00Z
```

---

## ğŸ”¬ æ‰‹åŠ¨æµ‹è¯•æ–¹æ³•

### æ–¹æ³•1ï¼šä½¿ç”¨ curl

```bash
# 1. ç™»å½•
curl -X POST http://localhost:8080/user/login \
  -H "Content-Type: application/json" \
  -d '{"phone":"13800138000","password":"123456"}'

# 2. å¤åˆ¶ tokenï¼Œç«‹å³æµ‹è¯•ï¼ˆæˆåŠŸï¼‰
curl -X GET http://localhost:8080/user/info \
  -H "Authorization: ä½ çš„token"

# 3. ç­‰å¾… 1 åˆ†é’Ÿ...
sleep 60

# 4. å†æ¬¡æµ‹è¯•ï¼ˆå¤±è´¥ï¼‰
curl -X GET http://localhost:8080/user/info \
  -H "Authorization: ä½ çš„token"
```

### æ–¹æ³•2ï¼šä½¿ç”¨ test_login.http

```http
### æ­¥éª¤1ï¼šç™»å½•ï¼ˆå¤åˆ¶è¿”å›çš„ tokenï¼‰
POST http://localhost:8080/user/login
Content-Type: application/json

{
  "phone": "13800138000",
  "password": "123456"
}

###

### æ­¥éª¤2ï¼šç«‹å³æµ‹è¯•ï¼ˆæ›¿æ¢ tokenï¼Œåº”è¯¥æˆåŠŸï¼‰
GET http://localhost:8080/user/info
Authorization: ä½ çš„token

###

### æ­¥éª¤3ï¼šç­‰å¾… 1 åˆ†é’Ÿåå†æ‰§è¡Œä¸Šé¢çš„è¯·æ±‚ï¼ˆåº”è¯¥å¤±è´¥ï¼‰
```

---

## ğŸ“ æµ‹è¯•è®°å½•æ¨¡æ¿

å¤åˆ¶ä»¥ä¸‹æ¨¡æ¿è®°å½•æµ‹è¯•ç»“æœï¼š

```
æµ‹è¯•æ—¶é—´ï¼š2024-10-18 14:30:00
æµ‹è¯•äººå‘˜ï¼š
Token æœ‰æ•ˆæœŸï¼š1 åˆ†é’Ÿ

æµ‹è¯•ç»“æœï¼š
[ ] ç™»å½•æˆåŠŸï¼Œè·å– token
[ ] ç«‹å³ä½¿ç”¨ token - æˆåŠŸ
[ ] 30 ç§’åä½¿ç”¨ token - æˆåŠŸ
[ ] 60 ç§’åä½¿ç”¨ token - å¤±è´¥ï¼ˆè¿‡æœŸï¼‰
[ ] é”™è¯¯ä¿¡æ¯åŒ…å« "JWT expired"
[ ] é‡æ–°ç™»å½•å¯è·å–æ–° token

ç»“è®ºï¼š
[ ] Token è¿‡æœŸæœºåˆ¶æ­£å¸¸å·¥ä½œ
[ ] Token è¿‡æœŸæ—¶é—´å‡†ç¡®ï¼ˆçº¦ 60 ç§’ï¼‰
```

---

## ğŸ”„ ä¿®æ”¹æœ‰æ•ˆæœŸ

æµ‹è¯•å®Œæˆåï¼Œå¯ä»¥æ”¹å›å…¶ä»–æ—¶é•¿ï¼š

### å¼€å‘ç¯å¢ƒï¼ˆæ¨è 1 å°æ—¶ï¼‰
```properties
jwt.expiration=3600000  # 1 å°æ—¶
```

### æµ‹è¯•ç¯å¢ƒï¼ˆæ¨è 1 å¤©ï¼‰
```properties
jwt.expiration=86400000  # 1 å¤©
```

### ç”Ÿäº§ç¯å¢ƒï¼ˆæ¨è 7 å¤©ï¼‰
```properties
jwt.expiration=604800000  # 7 å¤©
```

**ä¿®æ”¹åé‡å¯æœåŠ¡ï¼**

---

## ğŸ“Š ä¸åŒæ—¶é•¿å¯¹æ¯”

| æ—¶é•¿ | æ¯«ç§’å€¼ | é€‚ç”¨åœºæ™¯ |
|------|--------|---------|
| 10 ç§’ | 10000 | å¿«é€Ÿæµ‹è¯• |
| 1 åˆ†é’Ÿ | 60000 | **å½“å‰é…ç½®ï¼Œæµ‹è¯•ç”¨** |
| 5 åˆ†é’Ÿ | 300000 | çŸ­æœŸæµ‹è¯• |
| 30 åˆ†é’Ÿ | 1800000 | ç§»åŠ¨ç«¯åº”ç”¨ |
| 1 å°æ—¶ | 3600000 | Web åº”ç”¨ï¼ˆæ¨èï¼‰ |
| 1 å¤© | 86400000 | ä½é¢‘åº”ç”¨ |
| 7 å¤© | 604800000 | é•¿æœŸåº”ç”¨ |

---

## ğŸ’¡ æµ‹è¯•æŠ€å·§

### æŠ€å·§1ï¼šä½¿ç”¨æµè§ˆå™¨æ§åˆ¶å°å®æ—¶ç›‘æ§

```javascript
// ç™»å½•å¹¶æ¯ 10 ç§’æµ‹è¯•ä¸€æ¬¡
async function monitorToken() {
    // ç™»å½•
    const login = await fetch('http://localhost:8080/user/login', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify({ phone: '13800138000', password: '123456' })
    });
    const loginData = await login.json();
    const token = loginData.data.token;
    
    console.log('âœ… ç™»å½•æˆåŠŸï¼Œå¼€å§‹ç›‘æ§...');
    
    let count = 0;
    const interval = setInterval(async () => {
        count++;
        const elapsed = count * 10;
        
        const res = await fetch('http://localhost:8080/user/info', {
            headers: { 'Authorization': token }
        });
        const data = await res.json();
        
        if (data.code === 200) {
            console.log(`âœ… ${elapsed}ç§’ - Token æœ‰æ•ˆ`);
        } else {
            console.log(`âŒ ${elapsed}ç§’ - Token å·²è¿‡æœŸï¼`);
            console.log('é”™è¯¯:', data.msg);
            clearInterval(interval);
        }
    }, 10000);
}

// æ‰§è¡Œ
monitorToken();
```

### æŠ€å·§2ï¼šå‘½ä»¤è¡Œå¾ªç¯æµ‹è¯•

```bash
# å…ˆç™»å½•è·å– token
TOKEN=$(curl -s -X POST http://localhost:8080/user/login \
  -H "Content-Type: application/json" \
  -d '{"phone":"13800138000","password":"123456"}' \
  | grep -o '"token":"[^"]*"' | cut -d'"' -f4)

echo "Token: $TOKEN"
echo "å¼€å§‹æµ‹è¯•..."

# æ¯ 10 ç§’æµ‹è¯•ä¸€æ¬¡ï¼Œå…± 8 æ¬¡
for i in {1..8}; do
  echo ""
  echo "=== ç¬¬ $i æ¬¡æµ‹è¯•ï¼ˆ$(expr $i \* 10) ç§’åï¼‰ ==="
  curl -s -X GET http://localhost:8080/user/info \
    -H "Authorization: $TOKEN" | grep -o '"code":[0-9]*,"msg":"[^"]*"'
  sleep 10
done
```

---

## ğŸ‰ å¼€å§‹æµ‹è¯•

### æœ€ç®€å•çš„æ–¹æ³•ï¼š

1. **é‡å¯åç«¯** - `mvn spring-boot:run`
2. **æ‰“å¼€æµ‹è¯•é¡µé¢** - `test_token_expiration.html`
3. **ç‚¹å‡»å¼€å§‹** - åä¸‹æ¥å–æ¯å’–å•¡ â˜•
4. **ç­‰å¾… 1 åˆ†é’Ÿ** - è§‚å¯Ÿç»“æœ

---

## ğŸ“š ç›¸å…³æ–‡ä»¶

| æ–‡ä»¶ | è¯´æ˜ |
|------|------|
| `application.properties` | JWT é…ç½®ï¼ˆå·²æ”¹ä¸º 60000ï¼‰|
| `test_token_expiration.html` | è‡ªåŠ¨åŒ–æµ‹è¯•é¡µé¢ |
| `JWT_Tokenè¿‡æœŸæµ‹è¯•æŒ‡å—.md` | è¯¦ç»†æµ‹è¯•æ–‡æ¡£ |
| `test_login.http` | HTTP æµ‹è¯•æ–‡ä»¶ |

---

## âš ï¸ æ³¨æ„äº‹é¡¹

1. **å¿…é¡»é‡å¯æœåŠ¡** - é…ç½®ä¿®æ”¹åå¿…é¡»é‡å¯
2. **æ—¶é—´è¦å‡†ç¡®** - ç¡®ä¿ç­‰å¾…è¶³å¤Ÿé•¿æ—¶é—´ï¼ˆ60 ç§’ä»¥ä¸Šï¼‰
3. **è®°å½•æ—¥å¿—** - è§‚å¯Ÿå…·ä½“çš„è¿‡æœŸæ—¶é—´ç‚¹
4. **æµ‹è¯•å®Œæ¢å¤** - æµ‹è¯•åæ”¹å›åˆé€‚çš„æœ‰æ•ˆæœŸ

---

## ğŸŠ æµ‹è¯•å®Œæˆå

è®°å¾—æŠŠæœ‰æ•ˆæœŸæ”¹å›æ­£å¸¸å€¼ï¼š

```properties
# æ”¹ä¸º 1 å°æ—¶ï¼ˆæ¨èï¼‰
jwt.expiration=3600000
```

**ç„¶åé‡å¯æœåŠ¡ï¼**

ç¥æµ‹è¯•é¡ºåˆ©ï¼â°âœ…

