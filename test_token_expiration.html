<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>JWT Token è¿‡æœŸè‡ªåŠ¨æµ‹è¯•</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
        }

        h1 {
            color: #667eea;
            margin-bottom: 10px;
            text-align: center;
        }

        .config-info {
            background: #e3f2fd;
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            border-left: 4px solid #2196f3;
        }

        .config-info strong {
            color: #1976d2;
        }

        .controls {
            text-align: center;
            margin: 20px 0;
        }

        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 8px;
            font-size: 16px;
            cursor: pointer;
            margin: 0 10px;
            transition: transform 0.2s;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 20px rgba(102, 126, 234, 0.4);
        }

        button:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .btn-clear {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }

        .status-bar {
            background: #f8f9fa;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .status-item {
            text-align: center;
        }

        .status-label {
            font-size: 12px;
            color: #666;
            margin-bottom: 5px;
        }

        .status-value {
            font-size: 24px;
            font-weight: bold;
            color: #667eea;
        }

        .log-container {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 20px;
            border-radius: 10px;
            max-height: 500px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
        }

        .log-entry {
            margin: 5px 0;
            padding: 5px 0;
        }

        .log-time {
            color: #858585;
        }

        .log-success {
            color: #4ec9b0;
        }

        .log-error {
            color: #f48771;
        }

        .log-info {
            color: #4fc1ff;
        }

        .log-warning {
            color: #dcdcaa;
        }

        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>â° JWT Token è¿‡æœŸè‡ªåŠ¨æµ‹è¯•</h1>

        <div class="config-info">
            <strong>ğŸ“‹ æµ‹è¯•é…ç½®ï¼š</strong><br>
            â€¢ Token æœ‰æ•ˆæœŸï¼š<strong>1 åˆ†é’Ÿï¼ˆ60 ç§’ï¼‰</strong><br>
            â€¢ æµ‹è¯•é—´éš”ï¼šæ¯ 10 ç§’æµ‹è¯•ä¸€æ¬¡<br>
            â€¢ é¢„æœŸç»“æœï¼š60 ç§’å token å¤±æ•ˆ
        </div>

        <div class="status-bar">
            <div class="status-item">
                <div class="status-label">å·²æµ‹è¯•æ¬¡æ•°</div>
                <div class="status-value" id="test-count">0</div>
            </div>
            <div class="status-item">
                <div class="status-label">å·²ç”¨æ—¶é—´</div>
                <div class="status-value" id="elapsed-time">0ç§’</div>
            </div>
            <div class="status-item">
                <div class="status-label">Token çŠ¶æ€</div>
                <div class="status-value" id="token-status">æœªæµ‹è¯•</div>
            </div>
        </div>

        <div class="progress-bar">
            <div class="progress-fill" id="progress" style="width: 0%">0%</div>
        </div>

        <div class="controls">
            <button id="startBtn" onclick="startTest()">ğŸš€ å¼€å§‹è‡ªåŠ¨æµ‹è¯•</button>
            <button id="stopBtn" onclick="stopTest()" disabled>â¸ï¸ åœæ­¢æµ‹è¯•</button>
            <button class="btn-clear" onclick="clearLog()">ğŸ—‘ï¸ æ¸…é™¤æ—¥å¿—</button>
        </div>

        <div class="log-container" id="log"></div>
    </div>

    <script>
        let token = '';
        let testInterval = null;
        let testCount = 0;
        let startTime = null;

        function log(message, type = 'info') {
            const logDiv = document.getElementById('log');
            const time = new Date().toLocaleTimeString();
            const typeClass = `log-${type}`;
            logDiv.innerHTML += `<div class="log-entry ${typeClass}"><span class="log-time">[${time}]</span> ${message}</div>`;
            logDiv.scrollTop = logDiv.scrollHeight;
        }

        function clearLog() {
            document.getElementById('log').innerHTML = '';
            testCount = 0;
            updateStatus();
        }

        function updateStatus() {
            document.getElementById('test-count').textContent = testCount;
            
            if (startTime) {
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                document.getElementById('elapsed-time').textContent = elapsed + 'ç§’';
                
                // æ›´æ–°è¿›åº¦æ¡
                const progress = Math.min((elapsed / 80) * 100, 100);
                document.getElementById('progress').style.width = progress + '%';
                document.getElementById('progress').textContent = Math.floor(progress) + '%';
            }
        }

        async function startTest() {
            clearLog();
            testCount = 0;
            startTime = Date.now();
            
            document.getElementById('startBtn').disabled = true;
            document.getElementById('stopBtn').disabled = false;
            
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
            log('ğŸš€ JWT Token è¿‡æœŸæµ‹è¯•å¼€å§‹', 'info');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
            log('', 'info');

            // 1. ç™»å½•è·å– token
            log('ğŸ“ æ­¥éª¤1ï¼šç™»å½•è·å– token...', 'info');
            try {
                const loginRes = await fetch('http://localhost:8080/user/login', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        phone: '13800138000',
                        password: '123456'
                    })
                });
                const loginData = await loginRes.json();
                
                if (loginData.code === 200) {
                    token = loginData.data.token;
                    log(`âœ… ç™»å½•æˆåŠŸï¼`, 'success');
                    log(`ğŸ“Œ Token: ${token.substring(0, 50)}...`, 'success');
                    log(`ğŸ‘¤ ç”¨æˆ·: ${loginData.data.user.nikeName} (${loginData.data.user.phone})`, 'success');
                    document.getElementById('token-status').textContent = 'æœ‰æ•ˆ';
                    document.getElementById('token-status').style.color = 'green';
                } else {
                    log(`âŒ ç™»å½•å¤±è´¥: ${loginData.msg}`, 'error');
                    document.getElementById('startBtn').disabled = false;
                    document.getElementById('stopBtn').disabled = true;
                    return;
                }
            } catch (error) {
                log(`âŒ ç™»å½•è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
                log(`ğŸ’¡ æç¤º: è¯·ç¡®ä¿åç«¯æœåŠ¡å·²å¯åŠ¨ï¼ˆhttp://localhost:8080ï¼‰`, 'warning');
                document.getElementById('startBtn').disabled = false;
                document.getElementById('stopBtn').disabled = true;
                return;
            }

            log('', 'info');
            log('ğŸ“ æ­¥éª¤2ï¼šå¼€å§‹å®šæ—¶æµ‹è¯•ï¼ˆæ¯10ç§’æµ‹è¯•ä¸€æ¬¡ï¼‰...', 'info');
            log('â° é¢„è®¡ 60 ç§’å token å°†è¿‡æœŸ', 'warning');
            log('', 'info');

            // 2. å®šæ—¶æµ‹è¯•
            testInterval = setInterval(async () => {
                testCount++;
                const elapsed = Math.floor((Date.now() - startTime) / 1000);
                updateStatus();
                
                log(`â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”`, 'info');
                log(`ğŸ” ç¬¬ ${testCount} æ¬¡æµ‹è¯•ï¼ˆå·²è¿‡ ${elapsed} ç§’ï¼‰`, 'info');
                
                try {
                    const res = await fetch('http://localhost:8080/user/info', {
                        headers: { 'Authorization': token }
                    });
                    const data = await res.json();
                    
                    if (data.code === 200) {
                        log(`âœ… Token æœ‰æ•ˆ - æˆåŠŸè·å–ç”¨æˆ·ä¿¡æ¯`, 'success');
                        log(`   ç”¨æˆ·: ${data.data.data.nikeName} (ID: ${data.data.data.id})`, 'success');
                    } else if (data.code === 401) {
                        log(`âŒ Token å·²è¿‡æœŸï¼è¿”å›çŠ¶æ€ç : 401 âœ…`, 'error');
                        log(`   é”™è¯¯ä¿¡æ¯: ${data.msg}`, 'error');
                        log('', 'info');
                        log(`ğŸ‰ æµ‹è¯•æˆåŠŸï¼Token åœ¨çº¦ ${elapsed} ç§’åè¿‡æœŸ`, 'success');
                        log(`âœ… è¿”å›æ­£ç¡®çš„ 401 çŠ¶æ€ç `, 'success');
                        log(`âœ… JWT è¿‡æœŸæœºåˆ¶å·¥ä½œæ­£å¸¸ï¼`, 'success');
                        
                        document.getElementById('token-status').textContent = 'å·²è¿‡æœŸ';
                        document.getElementById('token-status').style.color = 'red';
                        
                        stopTest();
                    } else {
                        log(`âš ï¸ å…¶ä»–é”™è¯¯ (Code: ${data.code}): ${data.msg}`, 'warning');
                        stopTest();
                    }
                } catch (error) {
                    log(`âŒ è¯·æ±‚å¤±è´¥: ${error.message}`, 'error');
                }
                
                // æœ€å¤šæµ‹è¯• 8 æ¬¡ï¼ˆ80 ç§’ï¼‰
                if (testCount >= 8) {
                    log('', 'info');
                    log('âš ï¸ å·²è¾¾åˆ°æœ€å¤§æµ‹è¯•æ¬¡æ•°ï¼ˆ8æ¬¡ï¼‰ï¼Œåœæ­¢æµ‹è¯•', 'warning');
                    stopTest();
                }
            }, 10000);  // æ¯ 10 ç§’æ‰§è¡Œä¸€æ¬¡
        }

        function stopTest() {
            if (testInterval) {
                clearInterval(testInterval);
                testInterval = null;
            }
            document.getElementById('startBtn').disabled = false;
            document.getElementById('stopBtn').disabled = true;
            
            log('', 'info');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
            log('â¹ï¸ æµ‹è¯•å·²åœæ­¢', 'info');
            log('â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•', 'info');
        }

        // å®šæ—¶æ›´æ–°å·²ç”¨æ—¶é—´
        setInterval(() => {
            if (startTime && testInterval) {
                updateStatus();
            }
        }, 1000);
    </script>
</body>
</html>

