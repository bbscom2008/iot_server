# IoTå†œç‰§ç‰©è”ç½‘ç³»ç»Ÿ - éƒ¨ç½²æŒ‡å—

## ğŸ‰ ç³»ç»Ÿé‡æ„å®Œæˆï¼

ä½ çš„åç«¯å·²ç»å®Œå…¨é‡å†™ï¼Œç°åœ¨æ˜¯ä¸€ä¸ªå®Œæ•´çš„IoTç‰©è”ç½‘ç³»ç»Ÿï¼Œå¯ä»¥ä¸UniAppå‰ç«¯å®Œç¾å¯¹æ¥ã€‚

---

## ğŸ“¦ é¡¹ç›®ç»“æ„

```
demo/
â”œâ”€â”€ src/main/java/com/example/demo/
â”‚   â”œâ”€â”€ config/                    # é…ç½®ç±»
â”‚   â”‚   â”œâ”€â”€ GlobalExceptionHandler.java  # å…¨å±€å¼‚å¸¸å¤„ç†
â”‚   â”‚   â””â”€â”€ WebConfig.java              # Webé…ç½®ï¼ˆè·¨åŸŸç­‰ï¼‰
â”‚   â”œâ”€â”€ controller/                # æ§åˆ¶å™¨å±‚
â”‚   â”‚   â”œâ”€â”€ UserController.java         # ç”¨æˆ·æ¥å£
â”‚   â”‚   â”œâ”€â”€ DeviceController.java       # è®¾å¤‡æ¥å£
â”‚   â”‚   â”œâ”€â”€ DeviceWarningController.java # æŠ¥è­¦æ¥å£
â”‚   â”‚   â””â”€â”€ DictDataController.java     # å­—å…¸æ¥å£
â”‚   â”œâ”€â”€ service/                   # æœåŠ¡å±‚
â”‚   â”‚   â”œâ”€â”€ UserService.java
â”‚   â”‚   â”œâ”€â”€ DeviceService.java
â”‚   â”‚   â”œâ”€â”€ DeviceWarningService.java
â”‚   â”‚   â””â”€â”€ DictDataService.java
â”‚   â”œâ”€â”€ mapper/                    # MyBatis Mapper
â”‚   â”‚   â”œâ”€â”€ UserMapper.java
â”‚   â”‚   â”œâ”€â”€ DeviceMapper.java
â”‚   â”‚   â”œâ”€â”€ DeviceWarningMapper.java
â”‚   â”‚   â””â”€â”€ DictDataMapper.java
â”‚   â”œâ”€â”€ entity/                    # å®ä½“ç±»
â”‚   â”‚   â”œâ”€â”€ User.java
â”‚   â”‚   â”œâ”€â”€ Device.java
â”‚   â”‚   â”œâ”€â”€ DeviceWarning.java
â”‚   â”‚   â””â”€â”€ DictData.java
â”‚   â”œâ”€â”€ dto/                       # æ•°æ®ä¼ è¾“å¯¹è±¡
â”‚   â”‚   â”œâ”€â”€ ApiResponse.java
â”‚   â”‚   â”œâ”€â”€ LoginRequest.java
â”‚   â”‚   â”œâ”€â”€ LoginResponse.java
â”‚   â”‚   â”œâ”€â”€ PageResult.java
â”‚   â”‚   â””â”€â”€ DeviceStatistics.java
â”‚   â”œâ”€â”€ util/                      # å·¥å…·ç±»
â”‚   â”‚   â””â”€â”€ JwtUtil.java           # JWTå·¥å…·
â”‚   â””â”€â”€ DemoApplication.java       # å¯åŠ¨ç±»
â”œâ”€â”€ src/main/resources/
â”‚   â”œâ”€â”€ mapper/                    # MyBatis XML
â”‚   â”‚   â”œâ”€â”€ UserMapper.xml
â”‚   â”‚   â”œâ”€â”€ DeviceMapper.xml
â”‚   â”‚   â”œâ”€â”€ DeviceWarningMapper.xml
â”‚   â”‚   â””â”€â”€ DictDataMapper.xml
â”‚   â””â”€â”€ application.properties     # é…ç½®æ–‡ä»¶
â”œâ”€â”€ iot_database_init.sql          # æ•°æ®åº“åˆå§‹åŒ–è„šæœ¬
â””â”€â”€ pom.xml                        # Mavené…ç½®
```

---

## ğŸš€ éƒ¨ç½²æ­¥éª¤

### 1. åˆå§‹åŒ–æ•°æ®åº“

```bash
# è¿æ¥MySQL
mysql -u root -p

# æ‰§è¡Œåˆå§‹åŒ–è„šæœ¬
source iot_database_init.sql
```

æˆ–è€…åœ¨MySQLå®¢æˆ·ç«¯ä¸­æ‰§è¡Œ `iot_database_init.sql` æ–‡ä»¶ã€‚

**æ•°æ®åº“åç§°ï¼š** `iot_system`

### 2. ä¿®æ”¹æ•°æ®åº“å¯†ç 

ç¼–è¾‘ `src/main/resources/application.properties`ï¼š

```properties
spring.datasource.password=ä½ çš„MySQLå¯†ç 
```

### 3. å¯åŠ¨åç«¯æœåŠ¡

```bash
# æ–¹å¼1ï¼šä½¿ç”¨Maven
mvn clean install
mvn spring-boot:run

# æ–¹å¼2ï¼šåœ¨IDEä¸­ç›´æ¥è¿è¡Œ DemoApplication.java
```

å¯åŠ¨æˆåŠŸåï¼Œåç«¯è¿è¡Œåœ¨ï¼š**http://localhost:8080**

### 4. ä¿®æ”¹å‰ç«¯APIåœ°å€

ç¼–è¾‘å‰ç«¯é¡¹ç›® `C:\Users\Administrator\Desktop\server\dspace\src\utils\request.js`ï¼š

```javascript
// å°†APIåœ°å€æ”¹ä¸ºæœ¬åœ°åç«¯
const BASE_URL = 'http://localhost:8080/'
```

### 5. å¯åŠ¨å‰ç«¯é¡¹ç›®

```bash
cd C:\Users\Administrator\Desktop\server\dspace
npm run dev:h5
```

---

## ğŸ“‹ å·²å®ç°çš„APIæ¥å£

### ç”¨æˆ·æ¨¡å—

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| ç”¨æˆ·ç™»å½• | POST | `/user/login` | è¿”å›tokenå’Œç”¨æˆ·ä¿¡æ¯ |
| è·å–ç”¨æˆ·ä¿¡æ¯ | GET | `/user/info` | éœ€è¦token |
| æ›´æ–°ç”¨æˆ·ä¿¡æ¯ | POST | `/user/updateInfo` | éœ€è¦token |

### è®¾å¤‡æ¨¡å—

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| è·å–è®¾å¤‡åˆ—è¡¨ | GET | `/device/list` | æ”¯æŒåˆ†é¡µã€æœç´¢ã€ç­›é€‰ |
| è·å–è®¾å¤‡ç»Ÿè®¡ | GET | `/device/statistics` | æ€»æ•°ã€åœ¨çº¿ã€æŠ¥è­¦ |
| è·å–è®¾å¤‡è¯¦æƒ… | GET | `/device/{id}` | å•ä¸ªè®¾å¤‡è¯¦æƒ… |
| ç»‘å®šè®¾å¤‡ | POST | `/device/bind` | æ·»åŠ æ–°è®¾å¤‡ |
| è§£ç»‘è®¾å¤‡ | PUT | `/device/un/bind` | åˆ é™¤è®¾å¤‡ |

### æŠ¥è­¦æ¨¡å—

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| è·å–æŠ¥è­¦åˆ—è¡¨ | GET | `/device/warning/list` | åˆ†é¡µæŸ¥è¯¢ |
| æ¶ˆé™¤æŠ¥è­¦ | POST | `/device/warning/read` | æ ‡è®°å·²è¯» |
| æ¶ˆé™¤ç¯æ§ä»ªæŠ¥è­¦ | POST | `/device/hkyWarningRead/read` | æ ‡è®°å·²è¯» |

### å­—å…¸æ¨¡å—

| æ¥å£ | æ–¹æ³• | è·¯å¾„ | è¯´æ˜ |
|------|------|------|------|
| è·å–å­—å…¸æ•°æ® | GET | `/user/dict/data/list` | å…»æ®–ç±»å‹ã€è®¾å¤‡ç±»å‹ |

---

## ğŸ”‘ æµ‹è¯•è´¦å·

ç³»ç»Ÿå·²é¢„ç½®æµ‹è¯•æ•°æ®ï¼š

**è´¦å·1ï¼š**
- æ‰‹æœºå·ï¼š`13800138000`
- å¯†ç ï¼š`123456`
- æ‹¥æœ‰3ä¸ªè®¾å¤‡

**è´¦å·2ï¼š**
- æ‰‹æœºå·ï¼š`13900139000`
- å¯†ç ï¼š`123456`
- æ‹¥æœ‰1ä¸ªè®¾å¤‡

---

## ğŸ§ª æµ‹è¯•API

### ä½¿ç”¨Postmanæµ‹è¯•

#### 1. ç™»å½•è·å–Token

```
POST http://localhost:8080/user/login
Content-Type: application/json

{
  "phone": "13800138000",
  "password": "123456"
}
```

**å“åº”ç¤ºä¾‹ï¼š**
```json
{
  "code": 200,
  "msg": "success",
  "data": {
    "token": "eyJhbGciOiJIUzI1NiJ9...",
    "user": {
      "id": 1,
      "phone": "13800138000",
      "nikeName": "æµ‹è¯•ç”¨æˆ·",
      "address": "åŒ—äº¬å¸‚æœé˜³åŒº",
      "icon": null
    }
  }
}
```

#### 2. è·å–è®¾å¤‡åˆ—è¡¨

```
GET http://localhost:8080/device/list?pageNum=1&pageSize=10
Authorization: eyJhbGciOiJIUzI1NiJ9...
```

#### 3. è·å–è®¾å¤‡ç»Ÿè®¡

```
GET http://localhost:8080/device/statistics
Authorization: eyJhbGciOiJIUzI1NiJ9...
```

---

## âš™ï¸ æ•°æ®åº“è¡¨è¯´æ˜

### 1. usersï¼ˆç”¨æˆ·è¡¨ï¼‰
- å­˜å‚¨ç”¨æˆ·åŸºæœ¬ä¿¡æ¯
- ä½¿ç”¨æ‰‹æœºå·ç™»å½•
- å¯†ç æ˜æ–‡å­˜å‚¨ï¼ˆç”Ÿäº§ç¯å¢ƒéœ€åŠ å¯†ï¼‰

### 2. devicesï¼ˆè®¾å¤‡è¡¨ï¼‰
- å­˜å‚¨IoTè®¾å¤‡ä¿¡æ¯
- åŒ…å«æ¸©åº¦ã€æ¹¿åº¦ã€æ°”ä½“ç­‰ä¼ æ„Ÿå™¨æ•°æ®
- æ”¯æŒå¤šç§è®¾å¤‡ç±»å‹

### 3. device_warningsï¼ˆæŠ¥è­¦è¡¨ï¼‰
- å­˜å‚¨è®¾å¤‡æŠ¥è­¦è®°å½•
- æ”¯æŒå·²è¯»/æœªè¯»çŠ¶æ€

### 4. dict_dataï¼ˆå­—å…¸è¡¨ï¼‰
- å­˜å‚¨ç³»ç»Ÿå­—å…¸æ•°æ®
- å…»æ®–ç±»å‹ã€è®¾å¤‡ç±»å‹ç­‰

---

## ğŸ”’ Tokenè®¤è¯è¯´æ˜

ç³»ç»Ÿä½¿ç”¨JWT Tokenè¿›è¡Œèº«ä»½è®¤è¯ï¼š

1. **è·å–Token**ï¼šç”¨æˆ·ç™»å½•åè¿”å›token
2. **ä½¿ç”¨Token**ï¼šåœ¨è¯·æ±‚å¤´ä¸­æ·»åŠ  `Authorization: tokenå€¼`
3. **Tokenæœ‰æ•ˆæœŸ**ï¼š7å¤©ï¼ˆ604800000msï¼‰
4. **TokenåŒ…å«**ï¼šç”¨æˆ·IDå’Œæ‰‹æœºå·

**å‰ç«¯è‡ªåŠ¨å¤„ç†**ï¼šå‰ç«¯ `request.js` ä¼šè‡ªåŠ¨åœ¨åŒ…å« `/my/` çš„è·¯å¾„æ·»åŠ token

---

## ğŸ“ é‡è¦æç¤º

### âš ï¸ å®‰å…¨æ³¨æ„äº‹é¡¹

1. **å¯†ç æœªåŠ å¯†**ï¼šå½“å‰å¯†ç ä»¥æ˜æ–‡å­˜å‚¨ï¼Œç”Ÿäº§ç¯å¢ƒå¿…é¡»ä½¿ç”¨BCryptåŠ å¯†
2. **JWTå¯†é’¥**ï¼š`application.properties` ä¸­çš„JWTå¯†é’¥éœ€è¦æ›´æ¢ä¸ºå¤æ‚å­—ç¬¦ä¸²
3. **è·¨åŸŸé…ç½®**ï¼šå½“å‰å…è®¸æ‰€æœ‰åŸŸåï¼Œç”Ÿäº§ç¯å¢ƒéœ€é™åˆ¶

### ğŸ”§ åŠŸèƒ½æ‰©å±•å»ºè®®

1. **å¯†ç åŠ å¯†**
   ```java
   // æ·»åŠ Spring Securityä¾èµ–
   // ä½¿ç”¨BCryptPasswordEncoderåŠ å¯†
   ```

2. **è®¾å¤‡å®æ—¶æ•°æ®**
   - æ·»åŠ WebSocketæ”¯æŒ
   - å®æ—¶æ¨é€è®¾å¤‡çŠ¶æ€å˜åŒ–

3. **æŠ¥è­¦æ¨é€**
   - é›†æˆçŸ­ä¿¡é€šçŸ¥
   - é›†æˆå¾®ä¿¡æ¶ˆæ¯æ¨é€

4. **æ•°æ®ç»Ÿè®¡**
   - æ·»åŠ è®¾å¤‡å†å²æ•°æ®è®°å½•
   - ç”Ÿæˆæ•°æ®æŠ¥è¡¨å’Œå›¾è¡¨

---

## ğŸ› å¸¸è§é—®é¢˜

### Q1: æ•°æ®åº“è¿æ¥å¤±è´¥ï¼Ÿ
**A:** æ£€æŸ¥MySQLæ˜¯å¦å¯åŠ¨ï¼Œå¯†ç æ˜¯å¦æ­£ç¡®ï¼Œæ•°æ®åº“æ˜¯å¦å·²åˆ›å»º

### Q2: TokenéªŒè¯å¤±è´¥ï¼Ÿ
**A:** æ£€æŸ¥å‰ç«¯æ˜¯å¦æ­£ç¡®ä¼ é€’Authorizationå¤´éƒ¨ï¼ŒTokenæ˜¯å¦è¿‡æœŸ

### Q3: è®¾å¤‡åˆ—è¡¨ä¸ºç©ºï¼Ÿ
**A:** æ£€æŸ¥æ•°æ®åº“æ˜¯å¦æœ‰æµ‹è¯•æ•°æ®ï¼Œç”¨æˆ·IDæ˜¯å¦åŒ¹é…

### Q4: è·¨åŸŸé”™è¯¯ï¼Ÿ
**A:** å·²é…ç½®å…¨å±€è·¨åŸŸï¼Œå¦‚ä»æœ‰é—®é¢˜æ£€æŸ¥æµè§ˆå™¨æ§åˆ¶å°

---

## ğŸ“ ä¸‹ä¸€æ­¥

1. âœ… **æ•°æ®åº“åˆå§‹åŒ–** - æ‰§è¡Œ `iot_database_init.sql`
2. âœ… **ä¿®æ”¹é…ç½®** - æ›´æ–°æ•°æ®åº“å¯†ç 
3. âœ… **å¯åŠ¨åç«¯** - `mvn spring-boot:run`
4. âœ… **ä¿®æ”¹å‰ç«¯APIåœ°å€** - æŒ‡å‘ `http://localhost:8080/`
5. âœ… **å¯åŠ¨å‰ç«¯** - æµ‹è¯•åŠŸèƒ½
6. âœ… **ç™»å½•æµ‹è¯•** - ä½¿ç”¨æµ‹è¯•è´¦å·ç™»å½•

---

## ğŸŠ å®Œæˆï¼

ä½ ç°åœ¨æ‹¥æœ‰ä¸€ä¸ªå®Œæ•´çš„IoTç‰©è”ç½‘åç«¯ç³»ç»Ÿï¼ŒåŒ…å«ï¼š

- âœ… ç”¨æˆ·è®¤è¯ï¼ˆJWTï¼‰
- âœ… è®¾å¤‡ç®¡ç†ï¼ˆCRUDï¼‰
- âœ… æŠ¥è­¦ç®¡ç†
- âœ… æ•°æ®ç»Ÿè®¡
- âœ… å­—å…¸ç®¡ç†
- âœ… å…¨å±€å¼‚å¸¸å¤„ç†
- âœ… è·¨åŸŸæ”¯æŒ
- âœ… å®Œæ•´æ–‡æ¡£

**ç«‹å³å¼€å§‹æµ‹è¯•å§ï¼** ğŸš€

