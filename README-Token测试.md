# JWT Token 过期测试 - 完整指南 ⏰

## 🎯 已完成的配置

✅ **Token 有效期已修改为：1 分钟**

**配置位置：** `src/main/resources/application.properties` 第 17 行
```properties
jwt.expiration=60000  # 60000 毫秒 = 60 秒 = 1 分钟
```

---

## 🚀 开始测试（3 种方法）

### 方法 1：自动化测试页面（最简单！推荐）⭐

#### 步骤：
1. **重启后端**
   ```bash
   mvn spring-boot:run
   ```

2. **打开测试页面**
   - 在浏览器中打开：`test_token_expiration.html`

3. **点击"开始自动测试"按钮**

4. **观察结果**
   - 页面会自动登录
   - 每 10 秒测试一次
   - 约 60 秒后显示 "❌ Token 已过期"
   - 实时显示进度条和状态

**优点：** 全自动，可视化，无需手动操作

---

### 方法 2：使用 HTTP 测试文件（IDE 中）

#### 步骤：
1. **重启后端**

2. **打开** `test_login.http` 文件

3. **执行登录请求**（找到 "Token 过期测试" 部分）
   ```http
   POST http://localhost:8080/user/login
   Content-Type: application/json

   {
     "phone": "13800138000",
     "password": "123456"
   }
   ```

4. **复制返回的 token**

5. **立即执行测试**（替换 YOUR_TOKEN）
   ```http
   GET http://localhost:8080/user/info
   Authorization: 你的token
   ```
   **结果：** ✅ 成功

6. **等待 1 分钟**（看看手表 ⏰）

7. **再次执行相同请求**（不要改 token）
   **结果：** ❌ 失败，显示 "JWT expired"

**优点：** 可精确控制测试时间点

---

### 方法 3：使用 curl 命令行

#### 步骤：
```bash
# 1. 登录
curl -X POST http://localhost:8080/user/login \
  -H "Content-Type: application/json" \
  -d '{"phone":"13800138000","password":"123456"}'

# 2. 复制 token，保存为变量
TOKEN="eyJhbGciOiJIUzI1NiJ9.你的token"

# 3. 立即测试（成功）
curl -X GET http://localhost:8080/user/info \
  -H "Authorization: $TOKEN"

# 4. 等待 60 秒
sleep 60

# 5. 再次测试（失败）
curl -X GET http://localhost:8080/user/info \
  -H "Authorization: $TOKEN"
```

**优点：** 适合脚本自动化

---

## 📋 测试检查清单

执行测试前：
- [ ] 已修改 `application.properties` 中的 `jwt.expiration=60000`
- [ ] 已重启后端服务
- [ ] 后端正常运行在 http://localhost:8080
- [ ] 数据库已初始化，有测试用户数据

执行测试中：
- [ ] 登录成功，获取到 token
- [ ] 立即使用 token，返回 200（成功）
- [ ] 等待 60 秒
- [ ] 再次使用相同 token，返回 500（失败）
- [ ] 错误信息包含 "JWT expired at"

测试验证：
- [ ] Token 确实在 60 秒后失效
- [ ] 过期时间准确
- [ ] 错误信息清晰明确

---

## 🎨 测试页面功能预览

**`test_token_expiration.html` 页面包含：**

```
┌─────────────────────────────────────────┐
│  ⏰ JWT Token 过期自动测试              │
├─────────────────────────────────────────┤
│  测试配置：                              │
│  • Token 有效期：1 分钟（60 秒）         │
│  • 测试间隔：每 10 秒                    │
├─────────────────────────────────────────┤
│  状态栏：                                │
│  已测试次数: 6    已用时间: 60秒         │
│  Token状态: 已过期                       │
├─────────────────────────────────────────┤
│  进度条：                                │
│  ████████████████░░░░░░░░ 75%           │
├─────────────────────────────────────────┤
│  [🚀 开始测试] [⏸️ 停止] [🗑️ 清除]     │
├─────────────────────────────────────────┤
│  实时日志：                              │
│  [14:30:00] 🚀 测试开始                 │
│  [14:30:00] ✅ 登录成功                 │
│  [14:30:10] ✅ Token 有效（10秒）       │
│  [14:30:20] ✅ Token 有效（20秒）       │
│  ...                                     │
│  [14:31:00] ❌ Token 已过期！           │
│  [14:31:00] 🎉 测试成功！               │
└─────────────────────────────────────────┘
```

---

## 📊 预期测试输出

### 成功的测试日志

```
[14:30:00] 🚀 JWT Token 过期测试开始
[14:30:00] 📝 步骤1：登录获取 token...
[14:30:00] ✅ 登录成功！
[14:30:00] 📌 Token: eyJhbGciOiJIUzI1NiJ9...
[14:30:00] 👤 用户: 测试用户 (13800138000)
[14:30:00] 📝 步骤2：开始定时测试（每10秒测试一次）...
[14:30:00] ⏰ 预计 60 秒后 token 将过期

[14:30:10] 🔍 第 1 次测试（已过 10 秒）
[14:30:10] ✅ Token 有效 - 成功获取用户信息

[14:30:20] 🔍 第 2 次测试（已过 20 秒）
[14:30:20] ✅ Token 有效 - 成功获取用户信息

[14:30:30] 🔍 第 3 次测试（已过 30 秒）
[14:30:30] ✅ Token 有效 - 成功获取用户信息

[14:30:40] 🔍 第 4 次测试（已过 40 秒）
[14:30:40] ✅ Token 有效 - 成功获取用户信息

[14:30:50] 🔍 第 5 次测试（已过 50 秒）
[14:30:50] ✅ Token 有效 - 成功获取用户信息

[14:31:00] 🔍 第 6 次测试（已过 60 秒）
[14:31:00] ❌ Token 已失效！
[14:31:00] 错误: JWT expired at 2024-10-18T06:31:00Z...
[14:31:00] 🎉 测试成功！Token 在约 60 秒后过期
[14:31:00] ✅ JWT 过期机制工作正常！
```

---

## 🎉 总结

### 已完成：
✅ Token 有效期改为 1 分钟  
✅ 创建了自动化测试页面  
✅ 创建了详细的测试指南  
✅ 更新了 HTTP 测试文件  

### 立即开始：
1️⃣ **重启后端** → `mvn spring-boot:run`  
2️⃣ **打开测试页面** → `test_token_expiration.html`  
3️⃣ **点击开始测试** → 等待结果  

### 测试文件：
📄 `test_token_expiration.html` - 自动化测试页面（推荐）  
📄 `test_login.http` - HTTP 测试文件  
📄 `JWT_Token过期测试指南.md` - 详细文档  
📄 `Token过期测试-快速开始.md` - 快速指南  

**祝测试成功！** ⏰✅

